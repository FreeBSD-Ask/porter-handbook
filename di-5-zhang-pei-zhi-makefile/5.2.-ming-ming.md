# 5.2.命名

Port 的 **Makefile** 的第一部分命名 Port，描述其版本号，并将其列入正确的类别。

### 5.2.1. `PORTNAME`

将 `PORTNAME` 设置为软件的基础名称。它作为 FreeBSD 包的基础名称，并用于 [`DISTNAME`](https://docs.freebsd.org/en/books/porters-handbook/makefiles/#makefile-distname)。

|   | 包名称必须在整个 Ports 树中唯一。确保 `PORTNAME` 不被现有的 Port 使用，并且没有其他 Port 使用相同的 `PKGBASE`。如果该名称已被使用，可以添加 [`PKGNAMEPREFIX` 或 `PKGNAMESUFFIX`](https://docs.freebsd.org/en/books/porters-handbook/makefiles/#porting-pkgnameprefix-suffix)。 |
| - | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |

### 5.2.2. 版本，`DISTVERSION` *或* `PORTVERSION`

将 `DISTVERSION` 设置为软件的版本号。

`PORTVERSION` 是用于 FreeBSD 包的版本。它将自动从 `DISTVERSION` 推导出来，以便与 FreeBSD 的包版本方案兼容。如果版本中包含字母，可能需要设置 `PORTVERSION` 而不是 `DISTVERSION`。

|   | 一次只能设置 `PORTVERSION` 和 `DISTVERSION` 其中一个。 |
| - | ------------------------------------------ |

有时，某些软件使用的版本方案与 `DISTVERSION` 在 `PORTVERSION` 中的转换方式不兼容。

|   | 在更新 Port 时，可以使用 [pkg-version(8)](https://man.freebsd.org/cgi/man.cgi?query=pkg-version&sektion=8&format=html) 的 `-t` 参数检查新版本是否大于或小于之前的版本。请参阅 [使用](https://docs.freebsd.org/en/books/porters-handbook/makefiles/#makefile-versions-ex-pkg-version)[pkg-version(8) 比较版本](https://man.freebsd.org/cgi/man.cgi?query=pkg-version&sektion=8%3C/a%3E%20to%20Compare%20Versions&format=html)。 |
| - | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |

示例 1. 使用 [pkg-version(8)](https://man.freebsd.org/cgi/man.cgi?query=pkg-version&sektion=8&format=html) 比较版本

`pkg version -t` 接受两个版本作为参数，它会返回 `<`、`=` 或 `>`，如果第一个版本小于、等于或大于第二个版本。

```
% pkg version -t 1.2 1.3
< 
% pkg version -t 1.2 1.2
= 
% pkg version -t 1.2 1.2.0
= 
% pkg version -t 1.2 1.2.p1
> 
% pkg version -t 1.2.a1 1.2.b1
< 
% pkg version -t 1.2 1.2p1
<
```

|   | `1.2` 在 `1.3` 之前。                                            |
| - | ------------------------------------------------------------ |
|   | `1.2` 和 `1.2` 相等，因为它们版本相同。                                   |
|   | `1.2` 和 `1.2.0` 相等，因为零表示没有版本。                                |
|   | `1.2` 在 `1.2.p1` 之后，因为 `.p1`，可以理解为“预发布 1”。                   |
|   | `1.2.a1` 在 `1.2.b1` 之前，可以理解为“alpha”和“beta”，`a` 在 `b` 之前。     |
|   | `1.2` 在 `1.2p1` 之前，可以理解为“2，修补级别 1”，它是任何 `2.X` 后但在 `3` 之前的版本。 |

在这里，`a`、`b` 和 `p` 被用作“alpha”、“beta”或“预发布”和“修补级别”的缩写，但它们只是字母，按字母顺序排序，因此可以使用任何字母，它们将按适当的顺序排序。

**表 1. `DISTVERSION` 和派生的 `PORTVERSION` 示例**

| DISTVERSION | PORTVERSION |
| ----------- | ----------- |
| 0.7.1d      | 0.7.1.d     |
| 10Alpha3    | 10.a3       |
| 3Beta7-pre2 | 3.b7.p2     |
| 8\:f\_17    | 8f.17       |

**示例 2. 使用 `DISTVERSION`**

当版本号仅包含由点、破折号或下划线分隔的数字时，使用 `DISTVERSION`。

```
PORTNAME=   nekoto
DISTVERSION=	1.2-4
```

这将生成 `PORTVERSION` 为 `1.2.4`。

**示例 3. 使用 `DISTVERSION` 当版本以字母或前缀开始**

当版本以字母、前缀或后缀（这些不是版本的一部分）开始或结束时，使用 `DISTVERSIONPREFIX`、`DISTVERSION` 和 `DISTVERSIONSUFFIX`。

如果版本是 `v1.2-4`：

```
PORTNAME=   nekoto
DISTVERSIONPREFIX=  v
DISTVERSION=	1_2_4
```

有时，使用 GitHub 的项目会将其名称包含在版本中。例如，版本可能是 `nekoto-1.2-4`：

```
PORTNAME=   nekoto
DISTVERSIONPREFIX=  nekoto-
DISTVERSION=	1.2_4
```

这些项目有时还会在版本末尾使用某些字符串，例如 `1.2-4_RELEASE`：

```
PORTNAME=   nekoto
DISTVERSION=	1.2-4
DISTVERSIONSUFFIX=  _RELEASE
```

或者同时使用这两者，例如 `nekoto-1.2-4_RELEASE`：

```
PORTNAME=   nekoto
DISTVERSIONPREFIX=  nekoto-
DISTVERSION=	1.2-4
DISTVERSIONSUFFIX=  _RELEASE
```

`DISTVERSIONPREFIX` 和 `DISTVERSIONSUFFIX` 在构建 `PORTVERSION` 时不会使用，只会用于 `DISTNAME`。

所有这些都会生成 `PORTVERSION` 为 `1.2.4`。

**示例 4. 使用 `DISTVERSION` 当版本包含字母表示 "alpha"、"beta" 或 "pre-release"**

当版本包含由点、破折号或下划线分隔的数字，且字母表示“alpha”、"beta" 或 "pre-release"（即，在没有字母的版本之前），使用 `DISTVERSION`。

```
PORTNAME=   nekoto
DISTVERSION=	1.2-pre4
```

```
PORTNAME=   nekoto
DISTVERSION=	1.2p4
```

这两者都会生成 `PORTVERSION` 为 `1.2.p4`，它在 1.2 之前。[pkg-version(8)](https://man.freebsd.org/cgi/man.cgi?query=pkg-version&sektion=8&format=html) 可用于验证这一点：

```
% pkg version -t 1.2.p4 1.2
< 
```

**示例 5. 不使用 `DISTVERSION` 当版本包含字母表示 "Patch Level"**

当版本包含字母，但这些字母不是表示“alpha”、"beta" 或 "pre"（而是表示“修补级别”），且表示的是在没有字母的版本之后，使用 `PORTVERSION`。

```
PORTNAME=   nekoto
PORTVERSION=	1.2p4
```

在这种情况下，使用 `DISTVERSION` 是不可行的，因为它会生成 `1.2.p4` 的版本，这将排在 `1.2` 之前，而不是之后。[pkg-version(8)](https://man.freebsd.org/cgi/man.cgi?query=pkg-version&sektion=8&format=html) 将验证这一点：

```
% pkg version -t 1.2 1.2.p4
> 
% pkg version -t 1.2 1.2p4
<
```

|   | `1.2` 在 `1.2.p4` 之后，这在这种情况下是 *错误的*。 |
| - | ----------------------------------- |
|   | `1.2` 在 `1.2p4` 之前，这是所需的。           |

对于一些更高级的设置 `PORTVERSION` 示例，当软件的版本管理方式与 FreeBSD 的版本方案不兼容，或者当分发文件本身不包含版本时，参见 [`DISTNAME`](https://docs.freebsd.org/en/books/porters-handbook/makefiles/#makefile-distname)。

### 5.2.3. `PORTREVISION` 和 `PORTEPOCH`

#### 5.2.3.1. `PORTREVISION`

`PORTREVISION` 是一个单调递增的值，每次 `DISTVERSION` 增加时都会重置为 0，通常是在有新的官方供应商发布版本时。如果 `PORTREVISION` 非零，则该值会附加到包名中。`PORTREVISION` 的更改会被自动化工具（如 [pkg-version(8)](https://man.freebsd.org/cgi/man.cgi?query=pkg-version&sektion=8&format=html)）用于确定新包是否可用。

每次对端口进行更改，且该更改以某种方式影响生成的包时，都必须增加 `PORTREVISION`。这包括仅影响具有非默认 [选项](https://docs.freebsd.org/en/books/porters-handbook/makefiles/#makefile-options) 的包的更改。

以下是需要增加 `PORTREVISION` 的示例：

* 添加补丁以修复安全漏洞、错误或为端口添加新功能。
* 更改端口 **Makefile** 以启用或禁用包中的编译时选项。
* 更改包的打包清单或安装时的行为。例如，修改生成初始数据的脚本，如 [ssh(1)](https://man.freebsd.org/cgi/man.cgi?query=ssh&sektion=1&format=html) 主机密钥。
* 端口的共享库依赖项版本更新（在这种情况下，用户在安装依赖项的新版本后尝试安装旧包将失败，因为它会查找旧的 libfoo.x 而不是 libfoo.(x+1)）。
* 对端口分发文件进行的无声更改，且这些更改具有重要的功能差异。例如，对 `distinfo` 进行的更改，未更改 `DISTVERSION`，但通过 `diff -ru` 命令对旧版和新版进行比较，代码中存在非平凡的差异。
* 更改 `MAINTAINER`。

以下是一些不需要增加 `PORTREVISION` 的更改示例：

* 对端口骨架的样式更改，没有影响最终包的功能。
* 更改 `MASTER_SITES` 或其他端口的功能性更改，不会影响生成的包。
* 对分发文件进行微小的补丁，如拼写错误修正，这些不重要到需要用户进行升级。
* 构建修复，使得原本无法编译的包变得可编译。只要这些更改不会在以前能够构建的其他平台上引入功能性变化。由于 `PORTREVISION` 反映了包的内容，如果包之前无法构建，则不需要增加 `PORTREVISION` 来标记更改。

一个经验法则是决定是否提交到端口的更改是某些人会受益的。不管是增强功能、修复问题，还是因为新包实际上会正常工作。然后，权衡这一点与这样一个事实，即这会导致所有定期更新 Ports 树的人被迫进行更新。如果是这样，就必须增加 `PORTREVISION`。

|   | 如果没有增加 `PORTREVISION`，使用二进制包的人 *永远* 看不到更新。没有增加 `PORTREVISION`，包构建器无法检测到更改，因此无法重建包。 |
| - | ---------------------------------------------------------------------------------- |

